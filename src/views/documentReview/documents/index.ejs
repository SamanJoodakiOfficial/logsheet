<!DOCTYPE html>
<html lang="fa" dir="rtl">
	<%- include("../../partials/head") %>

	<body class="bg-primaryBackground">
		<div class="flex flex-col lg:flex-row min-h-screen">
			<!-- Sidebar -->
			<%- include('../../partials/sidebar') %>

			<!-- Main Content -->
			<main class="flex-1 p-4 lg:p-6">
				<header
					class="w-full flex items-center justify-between flex-wrap gap-2">
					<h2 class="font-bold text-202020 text-lg lg:text-xl">لیست شاخص‌ها</h2>
				</header>

				<%- include('../../partials/toast') %>

				<!-- فرم آپلود فایل -->
				<div class="mt-6">
					<form
						action="/document-reviews/documents/upload"
						method="POST"
						enctype="multipart/form-data"
						class="w-full min-h-[400px] bg-white rounded-lg p-4 mt-8 shadow-lg flex flex-col gap-3">
						<!-- نام مستند -->
						<div class="w-full flex flex-col gap-1">
							<label for="name" class="text-404040 text-xs">نام مستند</label>
							<input
								type="text"
								name="name"
								id="name"
								required
								placeholder="نام مستند"
								class="w-full h-12 border rounded-lg text-606060 bg-primaryBackground focus:ring-2 focus:ring-primary text-right outline-none p-4" />
						</div>

						<!-- دسته‌بندی -->
						<div class="w-full flex flex-col gap-1">
							<label for="category" class="text-404040 text-xs"
								>دسته‌بندی</label
							>
							<select
								name="category"
								id="category"
								required
								class="w-full h-16 border rounded-lg text-606060 bg-primaryBackground focus:ring-2 focus:ring-primary text-right outline-none p-4">
								<% categories.forEach(category => { %>
								<option value="<%= category._id %>">
									<%= category.name %>
								</option>
								<% }) %>
							</select>
						</div>

						<!-- آپلود فایل -->
						<div class="w-full flex flex-col items-center mt-4">
							<label
								for="file"
								class="cursor-pointer h-10 px-4 bg-blue-500 text-white rounded-lg shadow-lg">
								<i class="ri-upload-2-line"></i> انتخاب فایل
							</label>
							<input
								type="file"
								name="file"
								id="file"
								required
								class="hidden" />
						</div>

						<!-- دکمه ارسال -->
						<div
							class="w-full flex flex-col sm:flex-row items-center gap-4 sm:gap-2 mt-6">
							<button
								type="submit"
								class="w-full sm:w-full h-12 px-6 bg-primary text-white flex items-center justify-center font-bold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200">
								ثبت
							</button>
						</div>
					</form>
				</div>

				<div class="overflow-x-auto mt-8">
					<% if (documents && documents.length > 0) { %>
					<table
						class="w-full border-collapse border border-CBCBCB text-sm lg:text-base">
						<thead class="bg-gray-200">
							<tr>
								<th class="border border-CBCBCB p-2">نام</th>
								<th class="border border-CBCBCB p-2">دسته‌بندی</th>
								<th class="border border-CBCBCB p-2">بررسی ساختاری</th>
								<th class="border border-CBCBCB p-2">بررسی محتوایی</th>
								<th class="border border-CBCBCB p-2">خلاصه</th>
							</tr>
						</thead>
						<tbody>
							<% documents.forEach((document, index) => { %>
							<tr
								class="<%= index % 2 === 0 ? 'bg-white' : 'bg-gray-100' %> text-center">
								<td class="border border-CBCBCB p-2"><%= document.name %></td>
								<td class="border border-CBCBCB p-2">
									<%= document.category.name || '-' %>
								</td>
								<td class="border border-CBCBCB p-2">
									<a
										href="/document-reviews/documents/<%= document._id %>/analyze1"
										>بررسی ساختاری</a
									>
								</td>
								<td class="border border-CBCBCB p-2">
									<a
										href="/document-reviews/documents/<%= document._id %>/analyze2"
										>بررسی محتوایی</a
									>
								</td>
								<td class="border border-CBCBCB p-2">
									<a
										href="/document-reviews/documents/<%= document._id %>/analyze3"
										>خلاصه</a
									>
								</td>
							</tr>
							<% }) %>
						</tbody>
					</table>
					<% } else { %>
					<div
						class="w-full mt-6 bg-white rounded-lg shadow-lg p-4 text-center text-gray-500">
						هیچ شاخص یافت نشد.
					</div>
					<% } %>
				</div>
			</main>
		</div>

		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const deleteButtons = document.querySelectorAll('.delete-btn');
				deleteButtons.forEach((button) => {
					button.addEventListener('click', (e) => {
						e.preventDefault();
						const confirmation = confirm(
							'آیا مطمئن هستید که می‌خواهید این مستند را حذف کنید؟'
						);
						if (confirmation) {
							window.location.href = button.getAttribute('href');
						}
					});
				});
			});
		</script>
	</body>
</html>
